#include "../../firmware.h"

/**
 * @brief Update the status screen to show what is currently going on
 * * @param event Most recent Event* struct containing info on most recent changes
 * @param Pins PinStatus struct that contains info on all of the pins
 */
// MODIFICATION 1: The Pins parameter now expects an array of size 1.
void updateStatusDisplay(Event* event, PinStatus* Pins[1]){
    // get device number from event
    // The device number would be 0 for the single white light
    int device = event->device;
    int frequency = event->frequency;

    if (event->isActive){
        if (!Pins[device]->isRunningEvent){
            Pins[device]->isRunningEvent = true;
            if (frequency != 0){
                // MODIFICATION 2: We now write to row 1, since "White:" is on row 1.
                writeLCD("Flashing", 8, 1);
            } else {
                writeLCD("On", 8, 1);
            }
        }
    } else {
        if (Pins[device]->isRunningEvent){
            Pins[device]->isRunningEvent = false;
            // MODIFICATION 3: We now clear the space on row 1.
            writeLCD("         ", 8, 1);
        }
    }
}

/**
 * @brief Initialize the status screen with main words
 * */
void initStatus(char* filename){
    char displayName[30];
    strncpy(displayName, filename, 15);
    displayName[15] = '\0';
    char* shortDisplayName = displayName + 1;

    writeLCD(shortDisplayName, 0, 0);
    // MODIFICATION 4: We've removed the lines for Red and Green and moved White to a more central position.
    writeLCD("White:", 0, 1);
}

/**
 * @brief Update the percent done indicator on the status screen
 * * @param currentMinute int value of current total minutes into test
 * @param startMinute int value of the total minute of the first event start
 * @param endMinute int value of the total minute of the final event end
 */
void updateStatusPercentAndTime(int currentMinute, int startMinute, int endMinute, Time* currnetTime){
    int percent = (100 * (currentMinute - startMinute)) / (endMinute - startMinute);
    if (percent < 0){
        percent = 0;
    }
    writeLCD("%", 19, 1);

    if (percent < 10){
        writeLCDInt(percent, 18, 1);
    } else if (percent < 100){
        writeLCDInt(percent, 17, 1);
    } else {
        writeLCDInt(percent, 16, 1);
    }

    dispTime(currnetTime, 15, 0);
}
